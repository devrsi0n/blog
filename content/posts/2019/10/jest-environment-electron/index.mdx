---
title: å‰ç«¯å•æµ‹ jest è¿è¡Œç¯å¢ƒ - electron
author: Devrsi0n
date: 2019-10-25
hero: ./images/hero.jpg
heroReference: â€œtestâ€
excerpt: é€‰æ‹©æœ€ä¼˜çš„ jest è¿è¡Œç¯å¢ƒ
---

>> âš ï¸ 11.11 æ³¨ï¼š@jest-runner/electron å¹¶ä¸æ”¯æŒ jest vscode Debug è°ƒè¯•æ¨¡å¼ï¼Œå»ºè®®åªéƒ¨åˆ†å•æµ‹ç”¨è¿™ä¸ªç¯å¢ƒã€‚

Jest æ˜¯ä¸ªéå¸¸ä¸é”™çš„ JS å•æµ‹å·¥å…·ï¼ŒJest é›†æˆäº† JSDOM ä½œä¸ºå®ƒçš„é»˜è®¤è¿è¡Œç¯å¢ƒï¼Œå³åœ¨ Node.js è¿è¡Œæ—¶é‡Œé¢æ¨¡æ‹Ÿæµè§ˆå™¨ document ç­‰ DOM apiï¼Œä½†é™äº JSDOM æœ¬èº«èƒ½åŠ›ä¸€äº›é™åˆ¶ï¼Œå¾ˆå¤šæµè§ˆå™¨ api å¹¶æ²¡æœ‰æä¾›ï¼ˆæ¯”å¦‚ï¼š ä¹‹å‰åšå®¢æåˆ°çš„ [canvas](/articles/test-canvas-with-jest)ï¼Œlocalstorageï¼Œfetch ç­‰ç­‰ï¼‰ï¼Œå¦‚æœä¸éœ€è¦æ¨¡æ‹Ÿç›´æ¥æä¾›çœŸå®çš„æµè§ˆå™¨ç¯å¢ƒç”¨æ¥æµ‹è¯•å²‚ä¸æ˜¯å®Œå…¨å°±æ²¡æœ‰æ­¤ç±»çƒ¦æ¼äº†ï¼Ÿä¸é”™ï¼Œå¾ˆå¤šäººéƒ½æƒ³åˆ°äº†è¿™ä¸ªç‚¹å­ï¼Œå…·ä½“æŠ€æœ¯ä¸»è¦æ˜¯ç”¨ [Electron.js](https://electronjs.org/) æ¥å®ç°å’Œæ§åˆ¶æµè§ˆå™¨ç¯å¢ƒï¼ˆä¸çŸ¥é“ä»€ä¹ˆæ˜¯ Electron.js ï¼Ÿç®€å•çš„è¯´å°±æ˜¯ç”¨å‰ç«¯ç†Ÿæ‚‰çš„ Web æŠ€æœ¯æ ˆæ„å»ºè·¨å¹³å°çš„æ¡Œé¢åº”ç”¨ï¼‰ã€‚ç°æœ‰ç¤¾åŒºä¹Ÿæœ‰å¾ˆå¤šè½®å­å¯ä»¥ç”¨ï¼Œ

## jest-electron

ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯èš‚èšé‡‘æœå‡ºå“çš„ [jest-electron](https://juejin.im/post/5d88ba23e51d4561b416d549)ï¼Œä¸‹é¢å¼•ç”¨ä½œè€…ä¸€æ®µæ–‡ç« ï¼š

> ç›¸å…³è½®å­
>> `jest-runner/electron`
>>> æŠ„äº†ä¸€äº›ä»£ç ï¼Œä½†æ˜¯é—®é¢˜ï¼š
>>> - æ— æ³•ä¿æŒçª—å£è°ƒè¯•
>>> - è¿è¡Œå•æµ‹æ…¢ï¼ˆå• mainã€å½“ rendererï¼‰
>>> - ä»£ç æ™¦æ¶©

ä»¥ä¸Š `è¿è¡Œå•æµ‹æ…¢ï¼ˆå• mainã€å½“ rendererï¼‰` ä¸æ˜æ‰€ä»¥ï¼ŒçŒœæµ‹æ˜¯å• mian å’Œ å• renderer è¿›ç¨‹çš„æ„æ€ï¼Ÿå¾ˆæ˜æ˜¾ä½œè€…æ˜¯å€Ÿé‰´äº† Facebook å‡ºå“çš„ [jest-runner/electron](https://github.com/facebook-atom/jest-electron-runner)ï¼Œè€Œåˆé‰´äºä»£ç æ™¦æ¶©éš¾æ‡‚ï¼Œæ‰€ä»¥ä½œè€…é€ äº†ä¸ªç±»ä¼¼è½®å­ã€‚www

åœ¨æˆ‘çš„ [TypeScript å·¥ç¨‹](https://github.com/devrsi0n/Algorithms/tree/master/algs4)ä¸­ä½¿ç”¨è¿™ä¸ª `jest-electron` è½®å­ï¼Œç›´æ¥å°±è¿è¡Œä¸å‡ºç»“æœï¼ŒæŒ‰ä½œè€…è¯´æ˜æ‰“å¼€ Debug æ¨¡å¼ä¹Ÿæ²¡æœ‰æœ‰æ•ˆ Debug ä¿¡æ¯è¾“å‡ºï¼Œçœ‹æ¥è¿™ä¸ªè½®å­å¹¶æ²¡æœ‰å¾ˆå¥½çš„é€‚é… TypeScript ç”Ÿæ€ã€‚â•®(â•¯â–½â•°)â•­

ä¸Šé¢ä½œè€…å¯¹ Facebook è½®å­ jest-runner/electron çš„åæ§½åå€’è®©æˆ‘æƒ³è¯•ä¸‹èƒ½ä¸èƒ½é€‚é… TypeScript é¡¹ç›®ã€‚

## jest-runner/electron

æŒ‰ç…§[æ–‡æ¡£è¯´æ˜](https://github.com/facebook-atom/jest-electron-runner)ï¼Œé…ç½®æµè§ˆå™¨ç¯å¢ƒï¼ˆå³ testEnvironment ä½¿ç”¨ electron renderer è¿›ç¨‹ï¼‰ï¼Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¸€æ¬¡é€šè¿‡ï¼Œä¸€æ°”å‘µæˆï¼Œæ‰§è¡Œé€Ÿåº¦ä¹Ÿæ¯”æƒ³è±¡ä¸­çš„å¿«ï¼Œè€Œä¸”ä½œè€…è¿˜è´´å¿ƒçš„æç¤ºä¸€èˆ¬ä¸éœ€è¦æµè§ˆå™¨ç¯å¢ƒçš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥ä½¿ç”¨è¿™ä¸ªè½®å­çš„ electron main è¿›ç¨‹ï¼ˆå³ node ç¯å¢ƒ + electronjs apiï¼‰æ‰§è¡Œï¼Œå¯ä»¥æå‡æ¥è¿‘2å€çš„è¿è¡Œé€Ÿåº¦ï¼Œé¡ºä¾¿è¿˜å­¦ä¹ äº†ä¸‹ jest é…ç½®å¤šå·¥ç¨‹çš„åŠæ³•ã€‚ğŸ˜ƒ

### ç®€å•ä½¿ç”¨æ­¥éª¤

**å®‰è£…ä¾èµ–**

```shell
npm i -D @jest-runner/electron
```

**é…ç½® jest**

å•ç¯å¢ƒ

```js
// jest.config.js
{
  // ...
  runner: '@jest-runner/electron',
  testEnvironment: '@jest-runner/electron/environment',
}
```

å¤šç¯å¢ƒ

```js
// jest.config.js
const common = require('./jest.common.config')

module.exports = {
  projects: [
    {
      ...common,
      runner: '@jest-runner/electron/main',
      testEnvironment: 'node',
      // æŒ‡å®š node ç¯å¢ƒåŒ¹é…çš„æµ‹è¯•ç”¨ä¾‹
      testMatch: ['**/__node-tests__/**/*.(spec|test).ts']
    },
    {
      ...common,
      runner: '@jest-runner/electron',
      testEnvironment: '@jest-runner/electron/environment',
      // æŒ‡å®šæµè§ˆå™¨ç¯å¢ƒåŒ¹é…çš„æµ‹è¯•ç”¨ä¾‹
      testMatch: ['**/__tests__/**/*.(spec|test).tsx']
    }
  ]
}
```

## é—®é¢˜

âœ… å¦‚æœä½ é‡åˆ°äº†è¿™ä¸ªé…ç½®åœ¨ GitHub Actions/circleci ç­‰æœåŠ¡è·‘ä¸é€šè¿‡çš„é—®é¢˜ï¼Œè¯·å‚è€ƒ[ä½¿ç”¨ Electron æ—¶ GitHub Actions æ‰§è¡Œå¤±è´¥](/articles/github-actions-ci-failed-with-electron)

ğŸš§ @jest-runner/electron å¹¶ä¸æ”¯æŒ jest vscode Debug è°ƒè¯•æ¨¡å¼ï¼Œå»ºè®®åªéƒ¨åˆ†å•æµ‹ç”¨è¿™ä¸ªæ¡†æ¶ã€‚
check
